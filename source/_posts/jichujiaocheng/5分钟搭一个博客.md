---
title: 5åˆ†é’Ÿæ­ä¸€ä¸ªhexoåšå®¢
tags:
  - æ•™ç¨‹
  - Hexo
  - åŸºç¡€æ•™ç¨‹
categories: åŸºç¡€
keywords: 'hexo,é™æ€åšå®¢,hexoå¿«é€Ÿæ•™ç¨‹,é™æ€åšå®¢æ•™ç¨‹'
description: æ­å»ºhexoåšå®¢å¿«é€Ÿå…¥é—¨æ•™ç¨‹
top_img: >-
  https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/hexo.png
sticky: 10
cover: >-
  https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/hexo.png
comments: true
abbrlink: b9dc5266
date:
updated:
---


è¿™æ˜¯ä¸€ç¯‡åŸºç¡€æ•™ç¨‹ï¼Œç®€å•çš„æ­å»ºhexoåšå®¢
<!-- more -->



## å‰è¨€

<img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/hexo.png" style="zoom:50%;" />

**hexo**ä¹Ÿç®—æ˜¯è€ç‰Œåšå®¢æ¡†æ¶äº†ï¼Œä»¥å‰å¯¹äºhexoçš„äº†è§£ä¹Ÿä»…ä»…åœç•™åœ¨çŸ¥é“ä»–æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿå°†æœ¬åœ°çš„markdownæ–‡ä»¶ç”Ÿæˆé™æ€ç½‘ç«™çš„æ¡†æ¶ã€‚
æœ€æ—©çš„ä¸ªäººåšå®¢ç½‘ç«™è¿˜æ˜¯è‡ªå·±åŠ¨æ‰‹ï¼Œä»0-1çš„ä¸€ä¸ªspaï¼Œå¹¶åšäº†å¤§é‡seoï¼Œè®¾å¤‡é€‚é…ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œé…å¥—å¼€å‘çš„æœåŠ¡ä¹ŸåŒ…æ‹¬åå°ç®¡ç†ç³»ç»Ÿï¼ŒnodeæœåŠ¡ä»¥åŠsqlæ•°æ®åº“ï¼Œå½“ç„¶ä¸ªäººè¿˜å…¼å¤‡äº§å“è®¾è®¡ï¼ŒUIè®¾è®¡ç­‰å·¥ä½œã€‚

å…¥å‘å°è¯•hexoæ˜¯ç”±äºçœ‹åˆ°hexoï¼š

1. ä¸»é¢˜ä¸°å¯Œï¼Œä¸”å¤šç«¯é€‚é…è‰¯å¥½ã€‚
2. seoä¼˜åŒ–ï¼Œç½‘é¡µæ€§èƒ½ğŸ‘ğŸ»ã€‚
3. æ–¹ä¾¿ç®¡ç†ï¼Œè¿ç§»ã€‚



## å®‰è£…

å‡†å¤‡å¥½åŸºæœ¬ç¯å¢ƒï¼š

1. git
2. node

ç›´æ¥å…¨å±€å®‰è£…hexo-cli

```shell
npm install -g hexo-cli
```

è¿è¡Œæ£€æŸ¥æ˜¯å¦å®‰è£…å®Œæˆ

```shell
hexo version
```

## cmdå¿«é€Ÿè¾…åŠ©å·¥å…·



  - {% flink %}

    - link_list: 

      - name: å¿«é€Ÿè¾…åŠ©å·¥å…· 
        link: /posts/db0a31c8/
        avatar: http://q2.qlogo.cn/headimg_dl?dst_uin=1400000222&spec=640
        descr: cmdå¿«é€Ÿè¾…åŠ©å·¥å…·



{% endflink %}

æœ‰æ•ˆçš„å¿«é€Ÿå¼€å¯æœåŠ¡å…³é—­æœåŠ¡ï¼Œé¿å…æ¯æ¬¡éƒ½è¾“å…¥å‘½ä»¤çš„ç¹ç

## åˆå§‹åŒ–é¡¹ç›®

ä½¿ç”¨hero-cliåˆå§‹åŒ–blogé¡¹ç›®ï¼Œæˆ‘å–åå«"luna"å§ğŸŒ›ã€‚

```shell
hexo init luna
```

æ¥ç€å®‰è£…ä¾èµ–

```shell
cd luna
npm install
```

å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œçœ‹ä¸‹æ•ˆæœã€‚

```shell
hexo s
```

æ‰“å¼€`http://localhost:4000/`æŸ¥çœ‹æ•ˆæœ

![image-20220703154230288](https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220703154230288.png)



**æ–‡ç« è¿ç§»**

æŠŠåŸå…ˆå†™è¿‡çš„markdownï¼Œcopyåˆ°source/_postsã€‚

```shell
cp -r /Users/allen/Documents/blog /User/allen/Desktop/luna/source/_posts
```

> è¿™é‡Œæˆ‘æ²¡æ‰¾åˆ°å¦‚ä½•å¿«é€Ÿæ‰¹é‡é…ç½®front-matterçš„æ–¹å¼ï¼Œåªèƒ½æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªæ”¹äº†



## é…ç½®_config.yml

Yamlè¯­è¨€çš„é…ç½®æ–‡ä»¶ï¼Œå¯¹ç½‘ç«™è¿›è¡Œè¯¦ç»†çš„è®¾ç½®ã€‚

https://hexo.io/docs/configuration.html



## å®‰è£…ä¸»é¢˜

é»˜è®¤çš„ä¸»é¢˜æœ‰ç‚¹ä¸‘ï¼Œå¯ä»¥åˆ°å®˜ç½‘æ‰¾ä¸‹å–œæ¬¢çš„ã€‚

https://hexo.io/themes/

æˆ‘é€‰äº†Butterfly
https://butterfly.js.org/

æŒ‰ç…§æç¤ºå®‰è£…é…ç½®å³å¯ã€‚



## å†™ä¸ªwebæœåŠ¡å™¨

ç›®å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†hexoé¡¹ç›®çš„åˆå§‹åŒ–ï¼Œä½†hexoä»…æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ç”Ÿæˆçš„æ¡†æ¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ°æœºå™¨ä¸Šï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚

expresså³å¯æ»¡è¶³æˆ‘æ‰€æœ‰éœ€æ±‚ã€‚

å®‰è£…expressï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª`luna/www/index.js`ã€‚

```javascript
const express = require('express')
const app = express()
const port = 80

/** é™æ€èµ„æº */
app.use(express.static('./public'))

app.listen(port, () => {
  console.log(`app listening on port ${port}`)
})
```

å®‰è£…pm2ï¼Œæ·»åŠ scriptã€‚

```json
"scripts": {
	"logs": "pm2 logs",
  "start": "pm2 start ./www/index.js",
  "stop": "pm2 stop all"
}
```

å…¶å®å¿«é€Ÿåœ¨æœºå™¨ä¸Šæ›´æ–°ä»£ç è¿˜æŒºéº»çƒ¦çš„ï¼Œå†å†™ä¸ªè„šæœ¬ã€‚

```bash
echo "ğŸšš æ‹‰å–æœ€æ–°ä»£ç ..."
git pull

echo "ğŸš— æ›´æ–°npmåŒ…..."
npm install

echo "ğŸ“¦ï¸ æ‰“åŒ…å‰ç«¯ä»£ç ..."
npm run build

echo "ğŸŒï¸ å¯åŠ¨wwwæœåŠ¡..."
npm run stop
npm run start

echo "ğŸ‰ğŸ‰ğŸ‰ éƒ¨ç½²æˆåŠŸ!!!"
```

æ”¾åœ¨`luna/script/deploy.sh`ï¼Œç„¶åå†åŠ ä¸ªscriptã€‚

```json
"scripts": {
	"logs": "pm2 logs",
  "start": "pm2 start ./www/index.js",
  "stop": "pm2 stop all",
  "deploy": "sh ./script/deploy.sh"
}
```

æµ‹è¯•ä¸€ä¸‹ã€‚

```bash
npm run deploy
```

![image-20220721230920045](https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721230920045.png)

çœ‹èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ğŸ¤”



## æ­ä¸ªå›¾åºŠ

åšå®¢é‡Œå›¾ç‰‡èµ„æºé‚£ä¹ˆå¤šï¼Œä½ çœ‹æˆ‘çš„1Mçš„å­¦ç”ŸæœåŠ¡å™¨æ€ä¹ˆæ‰›å¾—ä½å‘¢ï¼Ÿå›¾ç‰‡èµ„æºéƒ½ä¸ŠCDNå§ã€‚

æœ¬èº«æˆ‘ä¹Ÿä¹ æƒ¯æœ¬åœ°ç”¨Typoraå†™åšï¼Œé‚£ä¹ˆå°±æ¨èä¸€ä¸‹picGoåšå›¾åºŠç®¡ç†å§ï¼Œmacä½“éªŒæ»¡åˆ†ã€‚

![image-20220721231448819](https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231448819.png)

[PicGoå®˜ç½‘](https://picgo.github.io/PicGo-Doc/)

æ”¯æŒçš„å›¾åºŠè¿˜è›®å¤šçš„ï¼ˆæˆ‘ç”¨COSï¼‰ï¼Œå…ˆé…ç½®å¥½ä½ çš„å›¾åºŠã€‚![image-20220721231557705](https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231557705.png)

æ‰“å¼€Typoraåå¥½è®¾ç½®ï¼Œé…ç½®PicGOè‡ªåŠ¨ä¸Šä¼ ã€‚

![image-20220721231756498](https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231756498.png)

è¯•è¯•åœ¨Typoraé‡Œç²˜è´´å›¾ç‰‡å§



## å®ç°è‡ªåŠ¨éƒ¨ç½²

è‡ªåŠ¨éƒ¨ç½²ä½¿ç”¨æ–¹å¼æˆ‘å†™è¿›äº†ä»“åº“çš„README.mdäº†

[è‡ªåŠ¨éƒ¨ç½²](https://github.com/AHREAL/luna#%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2)

100è¡Œå®ç°

```javascript
const dotenv = require("dotenv")
dotenv.config()

const { Buffer } = require('buffer');
const childrenProcess = require('child_process')
const bodyParser = require('body-parser')
const crypto = require('crypto');
const express = require('express')
const app = express()
const port = 80
const HUB_SECRET = process.env.HUB_SECRET;

app.use(bodyParser.json())

/** æ‰§è¡Œå‘½ä»¤ */
const exec = (bash) => {
  console.log(`ğŸ”§ å¼€å§‹æ‰§è¡Œå‘½ä»¤ ${bash}`)
  return new Promise((resolve, reject) => {
    childrenProcess.exec(bash, (error, stdout, stderr) => {
      if (error) {
        console.error(`ğŸ”§ å‘½ä»¤å‡ºé”™ ${bash} exec error: ${error}`);
        reject()
        return
      }
      console.log(`ğŸ”§ å‘½ä»¤å®Œæˆ ${bash} stdout: ${stdout} stderr: ${stderr}`);
      resolve()
    })
  })
}

/** æ ¡éªŒsig */
const validateHubSig = (req) => {
  try {
    if (!req.body) return false
    const signature = Buffer.from(`sha1=${crypto.createHmac('sha1', HUB_SECRET).update(JSON.stringify(req.body)).digest('hex')}`)
    const _signature = Buffer.from(req.headers['x-hub-signature'])
    if (signature.length !== _signature.length) {
      return false
    }
    return crypto.timingSafeEqual(signature, _signature)
  } catch (error) {
    console.error('validateHubSigFail', error)
    return false
  }
}

/** é™æ€èµ„æº */
app.use(express.static('./public'))

/** webhook - è‡ªåŠ¨åˆ·æ–° */
app.post('/refresh', (req, res) => {
  if (validateHubSig(req)) {
    console.log('ğŸ‚ webhookè‡ªåŠ¨åˆ·æ–°è§¦å‘ï¼Œæ­£åœ¨æ‰§è¡Œ...')
    exec('git pull')
      .then(exec.bind(this, 'npm install'))
      .then(exec.bind(this, 'npm run build'))
      .then(() => {
        console.log('ğŸ‰ è‡ªåŠ¨åˆ·æ–°å®Œæˆ!')
      }).catch(() => {
        console.log('âŒ è‡ªåŠ¨åˆ·æ–°å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—è¯¦æƒ…!')
      })
    res.status(200).send({
      msg:'webhook success'
    })
  }
  res.status(400).send({
    msg: 'validate signature fail'
  });
})

app.listen(port, () => {
  console.log(`app listening on port ${port}`)
})
```



å‰©ä¸‹å°±æ˜¯ç›´æ¥pushï¼Œå†ä¹Ÿä¸ç”¨ä¸Šæœºå™¨äº†ï¼ˆå½“ç„¶æœ‰BUGè¿˜æ˜¯è¦å»çš„ ğŸ˜…ï¼‰
